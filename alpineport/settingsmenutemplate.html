<div id="ace_settingsmenu" x-data="{ options: Object.entries(optionGroupsJSON.optionGroups) }" class="bg-[#2b2b2b] text-white shadow-lg overflow-x-hidden rounded-2xl p-2 z-50">
    
    <template x-for="[groupKey, object] in options" :key="groupKey">
        <div :id="groupKey" class="p-2">
            <h3 class="text-lg font-semibold capitalize mb-2" x-text="groupKey"></h3>
            
            <template x-for="[key_2, subData] in Object.entries(object)" :key="key_2">
                
                <div :id="key_2+'-container'" class="ace_optionsMenuEntry">
                    
                    <span class="font-thin text-sm" x-text="key_2"></span>
                    
                    <div :id="key_2" class="flex items-center">

                        <template x-if="Array.isArray(subData)">
                            
                            <template x-for="(subObject, index) in subData" :key="key_2 + '-' + index">
                                
                                <template x-if="!subObject.type && !subObject.ariaLabel">
                                    <input :id="key_2 + '-checkbox-' + index" type="checkbox" :name="key_2" class="ml-2" />
                                </template>
                                
                                <template x-if="subObject.type == 'number'">
                                    <div :id="key_2+'-number-'+index" class="flex items-center ml-2">
                                        <label x-text="subObject.ariaLabel"></label>
                                        <input type="number" :min="subObject.min" :max="subObject.max" 
                                            :value="subObject.defaultValue || (subObject.values && subObject.values[0])" 
                                            class="w-12 bg-[#303030] p-1 rounded-md text-center ml-2">
                                    </div>
                                </template>
                            </template>
                        </template>

                        <template x-if="!Array.isArray(subData)">
                            <div x-data="{ subObject: subData }"> 
                                
                                <template x-if="subObject.type == 'select'">
                                    <div :id="key_2+'-select-container'" class="ml-2">
                                        <select :id="key_2" class="bg-[#303030] hover:bg-[#444] rounded-2xl p-1 text-white w-auto">
                                            
                                            <template x-if="Array.isArray(subObject.items)">
                                                <template x-for="(item, index) in subObject.items" :key="index">
                                                    <option :value="item.value" x-text="item.caption" class="bg-[#303030]"></option>
                                                </template>
                                            </template>

                                            <template x-if="!Array.isArray(subObject.items)">
                                                <template x-for="[optGroupKey, optionsArray] in Object.entries(subObject.items)" :key="optGroupKey">
                                                    <optgroup :label="optGroupKey">
                                                        <template x-for="(subItem, index) in optionsArray" :key="index">
                                                            <option :value="subItem.value" x-text="subItem.caption" class="bg-[#303030]"></option>
                                                        </template>
                                                    </optgroup>
                                                </template>
                                            </template>
                                            
                                        </select>
                                    </div>
                                </template>

                                <template x-if="subObject.type == 'buttonBar'">
                                    <div :id="key_2+'-buttonbar'" class="flex ml-2">
                                        <template x-for="(item, index) in subObject.items" :key="index">
                                            <button 
                                                :id="key_2 + '-button-' + index" 
                                                :value="item.value" 
                                                x-text="item.caption"
                                                class="bg-[#1e1e1e] border border-neutral-700 text-white rounded-xl p-1 m-0.5 hover:bg-[#444]">
                                            </button>
                                        </template>
                                    </div>
                                </template>

                                <template x-if="subObject.type == 'number'">
                                    <div :id="key_2+'-number'" class="flex items-center ml-2">
                                        <input type="number" :value="subObject.defaultValue ? subObject.defaultValue : 17"
                                            :min="subObject.min" :max="subObject.max"
                                            class="w-10 bg-[#303030] p-1 rounded-md text-center">
                                        <template x-for="(item, index) in subObject.defaults" :key="index">
                                            <button :value="item.value" x-text="item.caption" class="bg-[#1e1e1e] border border-neutral-700 text-white rounded-xl p-1 m-0.5 hover:bg-[#444]"></button>
                                        </template>
                                    </div>
                                </template>

                                <template x-if="subObject.type == 'checkbox' || (!subObject.type && subObject.path)">
                                    <input :id="key_2 + '-input'" type="checkbox" class="ml-2" />
                                </template>

                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>
    </template>
</div>
    CreateNewButtonIn(divId, buttonText, PublishTopic = null) {//working adder
        const div = document.getElementById(divId);
        const button = document.createElement("button");
        button.innerText = buttonText;
        button.classList = "bg-[2b2b2b] hover:bg-gray-500 shadow-lg rounded-xl p-2 w-full m-1";
        button.id = buttonText.replace(/\s+/g, '-').toLowerCase() + '-button';
        button.className = "ace_optionsMenuEntry";
        div.insertBefore(button, div.firstChild);
        //   document.body.appendChild(div);
        button.addEventListener("click", () => {
            if (PublishTopic) {
                PubSub.publish(PublishTopic, "");
            }
            this.menuCloseButton = false;
        });

    },
    CreateNewCheckBoxInMoreControls(labelText, PublishTopic = null) {//working adder
        const table = document.getElementById("more-controls");
        const row = table.insertRow(0);
        row.className = "ace_optionsMenuEntry";
        const cell1 = row.insertCell(0);
        const cell2 = row.insertCell(1);
        const label = document.createElement("label");
        label.setAttribute("for", labelText);
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        label.appendChild(checkbox);
        cell1.appendChild(document.createTextNode(labelText));
        cell2.appendChild(label);
        checkbox.addEventListener("change", () => {
            if (PublishTopic) {
                PubSub.publish(PublishTopic, checkbox.checked);
            }
        });
    }
        this.CreateNewButtonIn("ace_settingsmenu", "Close Menu", "ace:settingsMenu:close");
        const fonsizeinput = document.getElementById("-fontSize");
        if (!fonsizeinput) {
            console.log("Font size input not found");
            return;
        }
        fonsizeinput.className = "w-8!";
        const buttonIncrement = document.createElement("button");
        buttonIncrement.innerText = " + ";
        buttonIncrement.id = "increment-fontsize";
        buttonIncrement.className = "bg-[#1e1e1e] border border-neutral-700 text-white rounded-xl p-1 text-center! m-0.5 hover:bg-[#444]  w-6!"; // Simplified classes

        const buttonDecrement = document.createElement("button");
        buttonDecrement.innerText = " - ";
        buttonDecrement.id = "decrement-fontsize";
        buttonDecrement.className = "bg-[#1e1e1e] border border-neutral-700 text-white rounded-xl p-1 text-center! mr-0.5 hover:bg-[#444]  w-6!";
        const parentElement = fonsizeinput.parentNode;
        const fontContainer = document.createElement("div");
        fontContainer.className = "flex items-center";
        buttonIncrement.addEventListener("click", () => {
            fonsizeinput.value = parseInt(fonsizeinput.value) + 1;
            PubSub.publish("ace:fontsize:increment", "");
        });

        buttonDecrement.addEventListener("click", () => {
            fonsizeinput.value = parseInt(fonsizeinput.value) - 1;
            PubSub.publish("ace:fontsize:decrement", "");
        });
        const fakeFontInput = document.createElement("input");
        fakeFontInput.type = "number";
        fakeFontInput.id = "-NeededToFakeThisToWorkWithButtonsGivenBelow-AcePleaseDontHardCodeFirstChild";
        fakeFontInput.value = this.editor.getFontSize();
        fakeFontInput.className = "hidden";
        fakeFontInput.disabled = true;
        fakeFontInput.oninput = function () {
            PubSub.publish("ace:fontsize:set", this.value);
            fonsizeinput.value = this.value;
        };
        parentElement.insertBefore(fontContainer, parentElement.firstChild);
        parentElement.insertBefore(fakeFontInput, parentElement.firstChild);
        fontContainer.appendChild(buttonDecrement);
        fontContainer.appendChild(fonsizeinput);
        fontContainer.appendChild(buttonIncrement);